@startuml
'ITERATION 2: Improved based on QA validation feedback.
'This diagram improves upon the original by:
' - Re-structuring with a main event loop (repeat/while) to represent a continuous user session.
' - Replacing the linear if-else chain with a central decision node for better readability of user choices.
' - Adding an explicit flow redirection from "Start Charging" to "View Session Status" for a more realistic UX.
' - Including explicit confirmation steps after state-changing actions (e.g., saving settings).
' - Consolidating related display actions into single, more abstract activities.
' - Formalizing the "for each station" check using a fork to represent concurrent data retrieval and display.

start

:Access Charging Management Feature;

repeat
  <> Main Menu

  if (Select 'Remote Control') then ([Remote Control])
    if (Is charging session active?) then ([yes])
      :Request to Stop Session;
      :Display 'Session Stopped' Confirmation;
    else ([no])
      if (Vehicle is plugged in & compatible?) then ([yes])
        :Request to Start Session;
        ' Flow transitions to viewing the newly active session
        --> (view_session)
      else ([no])
        :Display Error: "Vehicle not plugged in or charger incompatible";
      endif
    endif

  else if (View Active Session) then ([View Active Session])
    if (Is charging session active?) then ([yes])
      (view_session)
      :Display Session Details\n(SoC, Time to Full, Rate, V/A);
    else ([no])
      :Display "No active charging session";
    endif

  else if (Manage Settings) then ([Manage Settings])
    partition "Charging Settings" {
      if (Select 'Set Charge Limit') then ([yes])
        :Display interface with default 80% limit;
        if (User selects 'Charge to 100% for trip'?) then ([yes])
          :Set one-time charge limit to 100%;
          :Confirm 'One-Time Limit Set';
        else ([no])
          :Allow user to set a new maximum percentage;
          :Save and Confirm New Charge Limit;
        endif
      else ([Select 'Manage Schedules'])
        switch (User Action)
        case (Create Schedule)
          :Define start time or ready-by time;
          :Save and Confirm New Schedule;
        case (Edit Schedule)
          :Select an existing schedule;
          :Modify schedule details;
          :Save and Confirm Updated Schedule;
        case (Delete Schedule)
          :Select an existing schedule;
          :Confirm Deletion;
          :Delete Schedule and Confirm;
        endswitch
      endif
    }

  else if (Find Stations) then ([Find Stations])
    partition "Charging Station Finder" {
      :Display map of charging stations;
      if (User applies filters?) then ([yes])
        :Filter by connector type & power level;
        :Update map with filtered results;
      endif
      note right
        Availability for all visible stations
        is updated concurrently.
      end note
      fork
        :For each visible station;
        if (Real-time availability data is provided?) then ([yes])
          :Display real-time availability status;
        else ([no])
          :Display 'Availability Unknown';
        endif
      end fork
    }

  else ([Exit Feature])
    break
  endif
  -> <> Main Menu;
repeat while ()

stop

@enduml