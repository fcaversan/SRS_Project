@startuml

' Style settings for better readability
skinparam classAttributeIconSize 0
skinparam linetype ortho
skinparam shadowing false
skinparam roundcorner 10
skinparam defaultFontName "Segoe UI"
skinparam class {
    BackgroundColor White
    ArrowColor #262626
    BorderColor #262626
}
skinparam interface {
    BackgroundColor lightgreen
    ArrowColor #262626
    BorderColor #262626
}

' ---------- Enumerations for States, Types, and Locations ----------
enum LockState {
  LOCKED
  UNLOCKED
}

enum ComponentState {
  ACTIVE
  INACTIVE
}

enum ClimateSystemState {
    OFF
    ACTIVE
    PRECONDITIONING
}

enum TrunkLocation {
  FRONT
  REAR
}

enum DefrosterLocation {
  FRONT
  REAR
}

enum ElementLocation {
    DRIVER_SEAT
    PASSENGER_SEAT
    REAR_LEFT_SEAT
    REAR_RIGHT_SEAT
    STEERING_WHEEL
}

enum PlugStatus {
    PLUGGED_IN
    UNPLUGGED
}

enum CommandStatus {
    SUCCESS
    FAILURE_AUTHENTICATION
    FAILURE_VEHICLE_UNREACHABLE
    FAILURE_INVALID_PRECONDITION
    FAILURE_TIMEOUT
}

enum VehicleState {
    PARKED
    DRIVING
    CHARGING
}
note left
  **IMPROVEMENT (Feedback #1):**
  Provides the states for a formal Vehicle
  State Machine Diagram, establishing the
  basis for state-based command availability
  (e.g., trunk can only be opened when PARKED).
end note

enum HeatingLevel {
    OFF
    LOW
    MEDIUM
    HIGH
}
note right
  **IMPROVEMENT (Feedback #4):**
  Introduces a type-safe enum for
  heating levels, replacing the primitive 'int'
  and aligning the model with API payloads.
end note


' ---------- Interfaces for Abstraction Refinement ----------
interface IToggleable <<(I,lightgreen)>> {
  + activate(): void
  + deactivate(): void
}

interface ILevelAdjustable <<(I,lightgreen)>> {
  + setLevel(level: HeatingLevel): void
  + getLevel(): HeatingLevel
}
note top
  **IMPROVEMENT (Feedback #4):**
  Interface updated to use the type-safe
  `HeatingLevel` enum, ensuring consistency
  for all adjustable components.
end note


' ---------- Data Transfer Objects (DTOs) and Value Objects ----------
class AuthToken <<(V,orchid) Value Object>> {
  + tokenValue: string
  + expiryDate: datetime
}

class CommandResponse <<(V,orchid) Value Object>> {
    + status: CommandStatus
    + message: string
}

class ElementSetting <<(D,orchid) Data>> {
    + active: bool
    + level: HeatingLevel
}

class ClimateSettings <<(D,orchid) Data>> {
    + targetTemperature: float
    + heatedElements: map<ElementLocation, ElementSetting>
    + defrosters: map<DefrosterLocation, bool>
}

' ---------- Services and Main Classes ----------
class AuthenticationService {
  + validateToken(token: AuthToken): bool
}

class MobileDevice {
  + deviceID: string
  --
  + sendLockRequest(authToken: AuthToken, vehicleID: string): CommandResponse
  + sendUnlockRequest(authToken: AuthToken, vehicleID: string): CommandResponse
  + sendClimateRequest(authToken: AuthToken, vehicleID: string, settings: ClimateSettings): CommandResponse
  + sendTrunkRequest(authToken: AuthToken, vehicleID: string, location: TrunkLocation): CommandResponse
  + sendAlertRequest(authToken: AuthToken, vehicleID: string): CommandResponse
  + displayWarning(message: string): void
  + triggerHapticFeedback(): void
}

class RemoteControlSystem {
  --
  + processLockRequest(authToken: AuthToken, vehicleID: string): CommandResponse
  + processUnlockRequest(authToken: AuthToken, vehicleID: string): CommandResponse
  + processClimateRequest(authToken: AuthToken, vehicleID: string, settings: ClimateSettings): CommandResponse
  + processTrunkRequest(authToken: AuthToken, vehicleID: string, location: TrunkLocation): CommandResponse
  + processAlertRequest(authToken: AuthToken, vehicleID: string): CommandResponse
}

class Vehicle {
  + vin: string
  + model: string
  - state: VehicleState
  --
  + getState(): VehicleState
}

' ---------- Vehicle Subsystem Classes ----------

class DoorSystem {
  - lockState: LockState
  --
  + lock(): void
  + unlock(): void
  + getLockState(): LockState
}

class ClimateControlSystem {
  - state: ClimateSystemState
  - targetTemperature: float
  --
  + activate(): void
  + deactivate(): void
  + setTargetTemperature(temp: float): void
}

abstract class HeatedElement {
  # location: ElementLocation
  # state: ComponentState
  --
  + getState(): ComponentState
}

class HeatedSeat {
  - heatingLevel: HeatingLevel
  --
  + activate(): void
  + deactivate(): void
  + setLevel(level: HeatingLevel): void
  + getLevel(): HeatingLevel
}

class HeatedSteeringWheel {
  + activate(): void
  + deactivate(): void
}

class Defroster {
  - location: DefrosterLocation
  - state: ComponentState
  --
  + activate(): void
  + deactivate(): void
}

class Trunk {
    - location: TrunkLocation
    - isOpen: bool
    --
    + open(): void
    + close(): void
}

class ExteriorAlertSystem {
  --
  + triggerAlert(): void
}

class PowerSystem {
    - plugStatus: PlugStatus
    --
    + isPluggedIn(): bool
}


' ---------- Relationships and Multiplicity ----------

' System-level relationships
RemoteControlSystem "1" -- "0..*" MobileDevice : communicates with >
RemoteControlSystem "1" -- "0..*" Vehicle : controls >
note on link
**IMPROVEMENT (Feedback #2):**
Changed from Aggregation to Association
for correct semantic relationship. The system
controls/communicates with entities it does not own.
end note
RemoteControlSystem "1" --> "1" AuthenticationService : uses

' Vehicle composition
Vehicle "1" *-- "1" DoorSystem
Vehicle "1" *-- "1" ClimateControlSystem
Vehicle "1" *-- "2" Trunk
Vehicle "1" *-- "1" ExteriorAlertSystem
Vehicle "1" *-- "1" PowerSystem

' ClimateControlSystem composition
ClimateControlSystem "1" *-- "0..*" HeatedElement
ClimateControlSystem "1" *-- "2" Defroster

' HeatedElement abstraction refinement
IToggleable <|.. HeatedElement
ILevelAdjustable <|.. HeatedSeat
HeatedElement <|-- HeatedSeat
HeatedElement <|-- HeatedSteeringWheel

' Dependency on DTOs and Value Objects
RemoteControlSystem ..> CommandResponse
MobileDevice ..> CommandResponse
RemoteControlSystem ..> ClimateSettings
MobileDevice ..> ClimateSettings
MobileDevice ..> AuthToken
RemoteControlSystem ..> AuthToken
ClimateSettings ..> ElementSetting
ElementSetting ..> HeatingLevel

@enduml