@startuml

skinparam classAttributeIconSize 0
hide empty members

class User {
  + userId: UUID
}

' Services / Facades
class ChargingManager {
  + startRemoteCharging(userId: UUID, vehicleId: UUID): ChargingSession
  + stopRemoteCharging(userId: UUID, sessionId: UUID): void
  + getChargingStatus(userId: UUID, sessionId: UUID): ChargingStatusDTO
  + setChargingLimit(userId: UUID, vehicleId: UUID, limit: int, isForTrip: boolean): void
  + createSchedule(userId: UUID, vehicleId: UUID, scheduleDetails: ScheduleDTO): ChargingSchedule
  + editSchedule(userId: UUID, scheduleId: UUID, scheduleDetails: ScheduleDTO): void
  + deleteSchedule(userId: UUID, scheduleId: UUID): void
  + findChargingStations(filter: FilterCriteria): List<ChargingStation>
}

' Service for a specific concern
class ChargingStationFinder {
  + findStations(criteria: FilterCriteria): List<ChargingStation>
}

' Repository Interface (newly added based on feedback)
interface IChargingStationRepository <<interface>> {
  + find(criteria: FilterCriteria): List<ChargingStation>
}

' Core Domain Entities
class Vehicle {
  - vehicleId: UUID
  - vin: String
  - isPluggedIn: boolean
  - currentSoC: int
}

class ChargingSettings {
  - maxChargeLimit: int
  - defaultDailyLimit: int = 80
  - oneTimeFullCharge: boolean
}

class ChargingSession {
  - sessionId: UUID
  - startTime: DateTime
  - endTime: DateTime
  - currentSoC: int
  - estimatedTimeToCompletion: Duration
  - currentRateKW: float
  - suppliedVoltage: float
  - suppliedAmperage: float
  - state: ChargingSessionState
}

class ChargingSchedule {
  - scheduleId: UUID
  - startTime: Time
  - readyByTime: Time
  - isActive: boolean
}

class ChargingStation {
  - stationId: UUID
  - location: Coordinates
  - networkOperator: String
  - isAvailable: boolean
  + availabilityLastUpdated: DateTime ' Added for data freshness
  + supportedConnectors: List<ConnectorType>
  + maxPowerLevelKW: PowerLevel
}

' Value Objects
class Coordinates {
  + latitude: double
  + longitude: double
}

class FilterCriteria {
  + centerPoint: Coordinates
  + searchRadiusMeters: int
  + connectorTypes: List<ConnectorType>
  + minPowerLevel: PowerLevel
}

' Data Transfer Objects
class ChargingStatusDTO {
  + currentSoC: int
  + estimatedTimeToCompletion: Duration
  + currentChargingRateKW: float
  + suppliedVoltage: float
  + suppliedAmperage: float
}

class ScheduleDTO {
  + startTime: Time
  + readyByTime: Time
  + isActive: boolean
}

' Enumerations
enum ChargingSessionState {
  INITIALIZED
  AUTHENTICATING
  CHARGING
  PAUSED
  COMPLETED
  FAULTED
}

enum ConnectorType {
  TYPE_1
  TYPE_2
  CCS
  CHADEMO
  TESLA_NACS
}

enum PowerLevel {
  LEVEL_1_AC
  LEVEL_2_AC
  DC_FAST_50KW
  DC_FAST_150KW
  DC_FAST_350KW
}


' Relationships
User ..> ChargingManager
User "1" o-- "1..*" Vehicle

ChargingManager "1" *-- "1" ChargingStationFinder
ChargingManager ..> Vehicle
ChargingManager ..> ChargingSession
ChargingManager ..> ChargingSchedule
ChargingManager ..> FilterCriteria
ChargingManager ..> ChargingStatusDTO
ChargingManager ..> ScheduleDTO

ChargingStationFinder "1" o-- "1" IChargingStationRepository
ChargingStationFinder ..> FilterCriteria
ChargingStationFinder ..> ChargingStation

Vehicle "1" *-- "1" ChargingSettings
Vehicle "1" o-- "0..*" ChargingSession
Vehicle "1" *-- "0..*" ChargingSchedule

ChargingStation "1" o-- "0..*" ChargingSession
ChargingStation "1" *-- "1" Coordinates

ChargingSession *-- ChargingSessionState

@enduml