@startuml

skinparam classAttributeIconSize 0
hide empty members

' =============================================
' Enums (Scoped to Home Screen needs)
' =============================================
enum LockStatus {
  LOCKED
  UNLOCKED
}

enum UnitSystem {
  METRIC {distance: km}
  IMPERIAL {distance: mi}
}

enum TempUnit {
  CELSIUS
  FAHRENHEIT
}

' =============================================
' Application Layer
' =============================================
package "Application" {

  class VehicleConnectApp {
    +main(): void
    +displayHomeScreen(): void
    +refreshVehicleStatus(): void
  }

  class User {
    -userId: UUID
    +getProfile(): UserProfile
  }

  class UserProfile {
    -distanceUnit: UnitSystem
    -temperatureUnit: TempUnit
    +getDistanceUnit(): UnitSystem
    +getTemperatureUnit(): TempUnit
  }
  
  class HomeScreenPresenter {
    +displayStateOfCharge: string
    +displayRange: string
    +displayLockStatus: LockStatus
    +displayCabinTemperature: string
    +isClimateActive: boolean
    +lastUpdatedTimestamp: string
    +updateView(status: VehicleStatus, profile: UserProfile): void
    +onRefreshRequested(): void
  }

}

' =============================================
' Vehicle Domain (Scoped to Home Screen needs)
' =============================================
package "Vehicle Domain" {

  class Vehicle {
    -vin: string
    -modelName: string
    -imageUrl: string
    +lock(): void
    +unlock(): void
  }

  class VehicleStatus {
    +stateOfCharge: float
    +estimatedRangeKm: float
    +lockStatus: LockStatus
    +cabinTemperatureCelsius: float
    +isClimateActive: boolean
    +lastUpdated: datetime
    +rangeCalculationBasis: RangeCalculationInput
  }
  
  class RangeCalculationInput {
    +recentEnergyConsumptionTrend: float
    +ambientTemperatureCelsius: float
  }

}

' =============================================
' External Interfaces
' =============================================
package "External Interfaces" {
  interface VehicleBackendAPI {
    +fetchVehicleStatus(vin: string): VehicleStatus
    +sendLockCommand(vin: string): boolean
    +sendUnlockCommand(vin: string): boolean
  }
  
  interface OSService {
    +showPushNotification(message: string): void
    +provideHapticFeedback(): void
  }
}


' =============================================
' Relationships
' =============================================

' --- Application Composition ---
VehicleConnectApp "1" *-- "1" HomeScreenPresenter : manages
VehicleConnectApp "1" o-- "1" User : (current session for)
User "1" *-- "1" UserProfile : manages

' --- Presenter Dependencies (MVP/MVVM Pattern) ---
' The Presenter orchestrates data fetching and formatting for the view.
HomeScreenPresenter ..> VehicleBackendAPI : fetches data via
HomeScreenPresenter ..> User : gets current user profile
HomeScreenPresenter ..> OSService : triggers feedback

' The Presenter uses domain models to format display data, addressing the unit conversion requirement.
HomeScreenPresenter "1" o-- "1" VehicleStatus : formats data from
HomeScreenPresenter "1" o-- "1" UserProfile : applies preferences from

' --- User and Vehicle Relationship ---
User "1" -- "1..*" Vehicle : has access to

' --- Vehicle Data Composition ---
' VehicleStatus encapsulates the data required by the home screen (FR-HSS-*).
Vehicle "1" ..> VehicleStatus : has its status represented by
' The basis for the range calculation is explicitly modeled as per FR-HSS-004.
VehicleStatus "1" *-- "1" RangeCalculationInput : is calculated using

' --- API Interaction ---
' The API is the source of truth for vehicle data.
VehicleBackendAPI ..> VehicleStatus : returns

@enduml