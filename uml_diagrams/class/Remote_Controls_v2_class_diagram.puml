@startuml

' Style settings for better readability
skinparam classAttributeIconSize 0
skinparam linetype ortho
skinparam shadowing false
skinparam roundcorner 10
skinparam defaultFontName "Segoe UI"
skinparam class {
    BackgroundColor White
    ArrowColor #262626
    BorderColor #262626
}

' ---------- Enumerations for States, Types, and Locations ----------
enum LockState {
  LOCKED
  UNLOCKED
}

enum ComponentState {
  ACTIVE
  INACTIVE
}

enum ClimateSystemState {
    OFF
    ACTIVE
    PRECONDITIONING
}
note left
  **IMPROVEMENT (QA Rec #2):**
  More specific state representation for the
  climate system, which supports a future
  State Machine Diagram.
end note

enum TrunkLocation {
  FRONT
  REAR
}

enum DefrosterLocation {
  FRONT
  REAR
}

enum ElementLocation {
    DRIVER_SEAT
    PASSENGER_SEAT
    REAR_LEFT_SEAT
    REAR_RIGHT_SEAT
    STEERING_WHEEL
}
note right
  **IMPROVEMENT (QA Rec #1):**
  Defined enum for heated element
  locations to ensure type safety
  and consistency in ClimateSettings.
end note

enum PlugStatus {
    PLUGGED_IN
    UNPLUGGED
}

enum CommandStatus {
    SUCCESS
    FAILURE
}

' ---------- Data Transfer Objects (DTOs) and Value Objects ----------
class CommandResponse <<(V,orchid) Value Object>> {
    + status: CommandStatus
    + message: string
}
note top
  **IMPROVEMENT (QA Rec #3):**
  Provides a structured way to return detailed
  success/failure information from commands,
  enabling better error handling.
end note

class ElementSetting <<(D,orchid) Data>> {
    + active: bool
    + level: int
}

class ClimateSettings <<(D,orchid) Data>> {
    + targetTemperature: float
    + heatedElements: map<ElementLocation, ElementSetting>
    + defrosters: map<DefrosterLocation, bool>
}
note top of ClimateSettings
  **IMPROVEMENT (QA Rec #1 & #5):**
  Uses the new `ElementLocation` enum and an
  `ElementSetting` DTO to allow for more
  complex settings like heating levels.
end note


' ---------- Main Classes ----------

class MobileDevice {
  + deviceID: string
  --
  + sendLockRequest(vehicleID: string): CommandResponse
  + sendUnlockRequest(vehicleID: string): CommandResponse
  + sendClimateRequest(vehicleID: string, settings: ClimateSettings): CommandResponse
  + sendTrunkRequest(vehicleID: string, location: TrunkLocation): CommandResponse
  + sendAlertRequest(vehicleID: string): CommandResponse
  + displayWarning(message: string): void
  + triggerHapticFeedback(): void
}
note right of MobileDevice::triggerHapticFeedback
  **FR-RMC-010**: Provide haptic feedback on
  successful lock or unlock command.
end note

class RemoteControlSystem {
  --
  + processLockRequest(vehicleID: string): CommandResponse
  + processUnlockRequest(vehicleID: string): CommandResponse
  + processClimateRequest(vehicleID: string, settings: ClimateSettings): CommandResponse
  + processTrunkRequest(vehicleID: string, location: TrunkLocation): CommandResponse
  + processAlertRequest(vehicleID: string): CommandResponse
}

class Vehicle {
  + vin: string
  + model: string
}

' ---------- Vehicle Subsystem Classes ----------

class DoorSystem {
  - lockState: LockState
  --
  + lock(): void
  + unlock(): void
  + getLockState(): LockState
}
note right of DoorSystem
  **FR-RMC-001**: Remotely lock doors.
  **FR-RMC-002**: Remotely unlock doors.
end note

class ClimateControlSystem {
  - state: ClimateSystemState
  - targetTemperature: float
  --
  + activate(): void
  + deactivate(): void
  + setTargetTemperature(temp: float): void
}
note top of ClimateControlSystem
  **FR-RMC-003**: Activate climate control.
  **FR-RMC-004**: Set target temperature.
end note

abstract class HeatedElement {
  # location: ElementLocation
  # state: ComponentState
  --
  + {abstract} activate(): void
  + {abstract} deactivate(): void
  + {abstract} setLevel(level: int): void
  + getState(): ComponentState
}

class HeatedSeat {
  - heatingLevel: int
  --
  + activate(): void
  + deactivate(): void
  + setLevel(level: int): void
}
note right of HeatedSeat
  **IMPROVEMENT (QA Rec #5):**
  Added specific attributes (`heatingLevel`) to
  subclass, making the abstraction more impactful
  and fulfilling **FR-RMC-005**.
end note

class HeatedSteeringWheel {
  + activate(): void
  + deactivate(): void
  + setLevel(level: int): void
}
note left of HeatedSteeringWheel::setLevel
  Implementation might just toggle
  ACTIVE/INACTIVE based on level > 0.
end note

class Defroster {
  - location: DefrosterLocation
  - state: ComponentState
  --
  + activate(): void
  + deactivate(): void
}
note right of Defroster
  **FR-RMC-006**: Activate front
  and rear defrosters.
end note

class Trunk {
    - location: TrunkLocation
    - isOpen: bool
    - isLocked: bool
    --
    + open(): void
    + close(): void
}
note right of Trunk
  **IMPROVEMENT:** Refactored from `TrunkSystem`
  to a more accurate object representation,
  fulfilling **FR-RMC-008**.
end note

class ExteriorAlertSystem {
  --
  + triggerAlert(): void
}
note right of ExteriorAlertSystem
  **IMPROVEMENT:** Consolidated methods
  to better match **FR-RMC-009**: "honk the horn
  and flash the lights".
end note

class PowerSystem {
    - plugStatus: PlugStatus
    - batteryLevel: int
    --
    + isPluggedIn(): bool
}
note top of PowerSystem
  **FR-RMC-007**: Check if vehicle is plugged in
  before preconditioning to avoid battery drain.
end note


' ---------- Relationships and Multiplicity ----------

' System-level relationships
RemoteControlSystem "1" o-- "0..*" MobileDevice : communicates with
RemoteControlSystem "1" o-- "0..*" Vehicle : controls

' Vehicle composition
Vehicle "1" *-- "1" DoorSystem
Vehicle "1" *-- "1" ClimateControlSystem
Vehicle "1" *-- "2" Trunk
Vehicle "1" *-- "1" ExteriorAlertSystem
Vehicle "1" *-- "1" PowerSystem

' ClimateControlSystem composition
ClimateControlSystem "1" *-- "0..*" HeatedElement
ClimateControlSystem "1" *-- "2" Defroster

' HeatedElement inheritance
HeatedElement <|-- HeatedSeat
HeatedElement <|-- HeatedSteeringWheel

' Dependency on DTOs and Value Objects
RemoteControlSystem ..> CommandResponse
MobileDevice ..> CommandResponse
RemoteControlSystem ..> ClimateSettings
MobileDevice ..> ClimateSettings
ClimateSettings ..> ElementSetting
HeatedElement ..> ElementLocation

@enduml